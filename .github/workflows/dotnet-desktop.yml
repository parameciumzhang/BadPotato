name: Build BadPotato Fix

on:
  workflow_dispatch:
  push:
    branches: [ master, main ]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v2

    - name: Restore NuGet packages
      run: |
        # 查找 .sln 或 .csproj 并还原依赖
        Get-ChildItem -Recurse -Filter *.csproj | ForEach-Object {
            nuget restore $_.FullName
        }

    - name: Build Solution (Force .NET 4.8)
      run: |
        # 强制使用 .NET 4.8 进行编译，解决找不到 v4.0 的问题
        Get-ChildItem -Recurse -Filter *.csproj | ForEach-Object {
            echo "Building: $($_.FullName)"
            msbuild $_.FullName /p:Configuration=Release /p:Platform="Any CPU" /p:TargetFrameworkVersion=v4.8
        }

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: BadPotato-Exe
        path: |
          **/bin/Release/*.exe
        retention-days: 1
